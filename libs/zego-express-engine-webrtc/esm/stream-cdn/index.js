!function(e,r){if("object"==typeof exports&&"object"==typeof module)module.exports=r(require("long"),require("protobufjs/minimal"));else if("function"==typeof define&&define.amd)define(["long","protobufjs/minimal"],r);else{var t="object"==typeof exports?r(require("long"),require("protobufjs/minimal")):r(e.long,e["protobufjs/minimal"]);for(var n in t)("object"==typeof exports?exports:e)[n]=t[n]}}("undefined"!=typeof self?self:this,(function(e,r){return function(){"use strict";var t={1290:function(e,r,t){t.d(r,{RnN:function(){return s},v$W:function(){return n},zUi:function(){return i},zub:function(){return o}});var n="zc.crh.a.0",i="zc.hrh.smt.0",o="zc.hrh.smt.1",s="zc.hrh.grdbc"},4908:function(e,r,t){t.d(r,{Of:function(){return s},iJ:function(){return u},ns:function(){return c},pO:function(){return o}});var n=t(8627),i=t(5095),o={event:"/sdk/start_publish",error:{t:n.LLz,i:n.Q9p,u:n.xfZ,l:n.gSF,m:n.PA0,p:n.fzq,_:n.f43,v:n.qvY,k:n.S4u,O:n.SRE,P:n.Xxx,q:n.g9p,j:n.jZ$,S:n.$wo,D:n.SmZ,C:n.VU9,N:n.MrD,T:n.ZpF,R:n.iei,J:n.aa2,B:n.HCP,Z:n.dg1,F:n._68,U:n.kbF,W:n.kOd,K:n.WP4,X:n.JDv,V:n.Q3v,Y:n.RBR,G:n.NCg,ee:n.xbZ,re:n.OdW,te:n.sJH},urls:i.yp,is_center:i.yS,server_url:i.tK,publish_option:i.Gq,message:i.tK,stream_id:i.tK,stream_sid:i.Tr,room_id:i.tK,video_en_codec_id:i.Tr,cap_w:i.Tr,cap_h:i.Tr,w:i.Tr,h:i.Tr,video_en_fps:i.Tr,video_en_bps:i.Tr,audio_c_channel_count:i.Tr,audio_en_bps:i.Tr,aec_level:i.Tr,ans_level:i.Tr,agc:i.yS,traffic_control_min_video_bitrate:{bitrate:i.Tr,mode:i.Tr},enable_camera:i.yS,enable_mic:i.yS,video_activate:i.yS,audio_activate:i.yS,gw_version:i.Tr,use_na:i.Tr,is_dual_stream:i.Tr},s={event:"/sdk/publish_target",error:{ne:n.ZEp,ie:n.xU2,oe:n.S4u,se:n.I7C,ue:n.HO9,ce:n.aUw,ae:n.Oy0}},u={event:"/mss/pushadd",error:{ne:n.ZEp},stream_id:i.tK,url:i.tK},c={event:"/mss/pushdel",error:{ne:n.ZEp},stream_id:i.tK,url:i.tK}},5095:function(e,r,t){t.d(r,{Gq:function(){return n},Tr:function(){return s},tK:function(){return i},yS:function(){return u},yp:function(){return o}});var n=function(e){return e},i=function(e){return e},o=function(e){return e},s=function(e){return e},u=function(e){return e}},8627:function(e,r,t){t.d(r,{$wo:function(){return M},Arx:function(){return be},B3d:function(){return me},Be2:function(){return ee},FB3:function(){return H},HCP:function(){return Z},HO9:function(){return v},I4J:function(){return je},I7C:function(){return Y},J79:function(){return c},JDv:function(){return te},JSm:function(){return re},L8E:function(){return I},LLz:function(){return E},MK1:function(){return ce},MrD:function(){return X},MuX:function(){return qe},NCg:function(){return $e},OdW:function(){return xe},OrZ:function(){return w},Oy0:function(){return m},PA0:function(){return a},PTE:function(){return y},Q3v:function(){return ne},Q9p:function(){return l},RBR:function(){return oe},RZs:function(){return Pe},RfS:function(){return L},S4u:function(){return o},S5f:function(){return f},SB8:function(){return pe},SRE:function(){return F},SmZ:function(){return x},Tij:function(){return ze},VU9:function(){return S},WP4:function(){return K},XHx:function(){return ve},Xxx:function(){return z},YDn:function(){return he},ZEp:function(){return d},ZpF:function(){return j},Zws:function(){return ge},_68:function(){return N},_HD:function(){return h},a$$:function(){return Ne},aUw:function(){return k},aa2:function(){return T},ann:function(){return ue},b1q:function(){return Oe},ckD:function(){return Se},clM:function(){return s},d49:function(){return u},dXc:function(){return Ee},dg1:function(){return D},dqB:function(){return ae},ekj:function(){return _e},f43:function(){return B},fzq:function(){return J},g9p:function(){return _},gHA:function(){return fe},gSF:function(){return p},hYx:function(){return De},hje:function(){return le},iei:function(){return C},jZ$:function(){return $},kOd:function(){return W},kbF:function(){return A},lgu:function(){return ke},m6U:function(){return V},mrK:function(){return Q},pWJ:function(){return we},qvY:function(){return ie},rBJ:function(){return Ce},sJH:function(){return q},sVF:function(){return g},s_m:function(){return P},t85:function(){return R},wxm:function(){return de},xU2:function(){return U},xbZ:function(){return se},xfZ:function(){return b},yK:function(){return O},zML:function(){return ye},zs3:function(){return G}});var n=t(8866),i="the user cancels the stream request.",o={code:1000002,message:"not login room"},s={code:1000014,message:"stream ID is too long"},u={code:1000015,message:"streamID is empty"},c={code:1000016,message:"stream ID contains illegal characters"},a={code:1000017,message:n.Rl},f={code:1000018,message:n.qC},d={code:1100001,message:n.dO},l={code:1100002,message:"network timeout."},m={code:1100999,message:"unknown server error"},h={code:1101005,message:"signal hb fail"},g={code:1002014,msg:n.fT},p={code:1102017,message:"dispatch error"},_={code:1102018,message:"token expired"},v={code:1102021,message:"biz channel error."},b={code:1102022,message:"dispatch request timeout"},k={code:1102024,message:"invalid channel"},z={code:1003025,message:"stream is forbided by media server"},y={code:1003050,message:"extra info of publishing stream is null"},E={code:1103001,message:n.dO},w={code:1103002,message:"browser do not support"},O={code:1103010,message:"screen fail"},P={code:1103011,message:"enumerate devices fail"},q={code:1103019,message:"publish streams auth fail"},j={code:1103021,message:"session request fail"},x={code:1103022,message:"create offer error"},S={code:1103023,message:"setLocalDescription error"},D={code:1103024,message:"mediaDesc error"},C={code:1103025,message:"other side offer error"},N={code:1103026,message:"candidate error"},$={code:1103027,message:"server session closed"},T={code:1103028,message:"ice connection error"},M={code:1103030,message:"negotiation timeout"},R={code:1103042,message:"screen canceled"},I={code:1103043,message:"screen not support"},J={code:1103044,message:n.aw},B={code:1103099,message:"stream is not capturing"},L={code:1103049,message:"repeated pull same stream"},Z={code:1103050,message:"websocket disconnected"},F={code:1103051,message:"publisher retry timeout"},H={code:1103053,message:"https is required"},U={code:1103055,message:n.Wk},A={code:1103056,message:"publish is publishing"},W={code:1103058,message:"client ip changed"},K={code:1103059,message:"ttl over time"},X={code:1103060,message:"session request timeout"},Q={code:1103061,message:"get media fail"},V={code:1103062,message:"update stream info fail"},Y={code:1103063,message:"publish target no response"},G={code:1103064,message:"get device not allowed"},ee={code:1103065,message:"device is not readable"},re={code:1103066,message:"device does not meet constraints"},te={code:1103067,message:"update sdp time out"},ne={code:1103068,message:"update sdp fail"},ie={code:1103073,message:"video effect is starting, please operate after video effect is started"},oe={code:1103078,message:"publish stream poor and net probe poor"},se={code:1103089,message:i},ue={code:1104001,message:"input parm error"},ce={code:1104021,message:"session request fail"},ae={code:1104022,message:"create offer error"},fe={code:1104023,message:"setLocalDescription error"},de={code:1104024,message:"mediaDesc error"},le={code:1104025,message:"other side offer error"},me={code:1104026,message:"candidate error"},he={code:1104027,message:"server session closed"},ge={code:1104028,message:"ice connection error"},pe={code:1104029,message:"websocket disconnected"},_e={code:1104030,message:"negotiation timeout"},ve={code:1104031,message:"player retry timeout"},be={code:1104032,message:"player is playing"},ke={code:1104033,message:"client ip changed"},ze={code:1104034,message:"ttl is over time"},ye={code:1104035,message:"reset session push"},Ee={code:1104036,message:"session request timeout"},we={code:1104037,message:"probe time out"},Oe={code:1104038,message:"resource mode is not supported"},Pe={code:1104039,message:"play stream not found"},qe={code:1104041,message:"stream quality poor and net probe poor"},je={code:1104042,message:i},xe={code:1104043,message:"mini sdp error"},Se={code:1104045,message:"play streams is out limit"},De={code:1104046,message:"play streams auth fail"},Ce={code:1103052,message:"publisher cdn push error"},Ne={code:1000055,message:"cdn url is invalid"},$e={code:1103100,message:"background process is start, but not subscribe yet"}},8866:function(e,r,t){t.d(r,{Rl:function(){return l},Wk:function(){return d},aw:function(){return u},dO:function(){return c},fT:function(){return o},h2:function(){return f},l3:function(){return n},pt:function(){return s},qC:function(){return a},rV:function(){return i}});t(7202),t(8627);var n=Promise;function i(e,r){return Math.floor(Math.random()*(r-e+1))+e}var o="room not exist",s="device is not found",u="stream is not from zego",c="input param error",a="local stream wrong",f="no preview",d="publish stream no found",l="network is broken"},7202:function(e,r,t){var n=t(6994);r.A=n.default||n},4872:function(e,r,t){function n(e){return"string"==typeof e}t.d(r,{QP:function(){return n}})},6994:function(r){r.exports=e},3788:function(e){e.exports=r}},n={};function i(e){var r=n[e];if(void 0!==r)return r.exports;var o=n[e]={exports:{}};return t[e](o,o.exports,i),o.exports}i.d=function(e,r){for(var t in r)i.o(r,t)&&!i.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},i.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};i.r(o),i.d(o,{StreamCDN:function(){return $}});var s,u=i(8627),c=i(4908),a=i(4872),f=i(1290),d=i(8866),l=function(){function e(e,r){this.fe=e,this.de=r,this.attempt=0,this.le=.3,this.me=4.8,this.he=0,this.retryTimer=null,this.maxTimer=null,this.isOverTime=!1,this.RETRY_MAX_TIME=60}return e.prototype.setRetryRule=function(e){switch(this.he=e,e){case 1:this.le=.3,this.me=32;break;case 0:this.le=.3,this.me=4.8}},e.prototype.getRetryDelayByCount=function(e){var r;r=1===this.he?e+2:e<2?0:e;var t=Math.min(this.me,this.le*Math.pow(2,r)),n=(0,d.rV)(0,1e3*t);return this.fe.info("".concat(f.RnN," ").concat(this.attempt," ").concat(t," ").concat(n)),n},e.prototype.initCallback=function(e,r){this.sucCallBack=e,this.failCallBack=r},e.prototype.startMaxTime=function(){var e,r=this;this.fe.info("".concat(f.zUi," ").concat(null===(e=this.requestInfo)||void 0===e?void 0:e.streamID," call")),this.maxTimer?this.fe.warn("".concat(f.zUi," max timer")):(this.maxTimer=setTimeout((function(){var e;r.fe.warn("".concat(f.zUi," ").concat(null===(e=r.requestInfo)||void 0===e?void 0:e.streamID," over max time ").concat(r.RETRY_MAX_TIME,"s, stop retry")),r.isOverTime=!0,r.requestFail(r._err)}),1e3*this.RETRY_MAX_TIME),this.fe.info("".concat(f.zUi," maxTimer=").concat(this.maxTimer)))},e.prototype.invalid=function(){this.clearRetryTimer(),this.attempt=0},e.prototype.clearRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},e.prototype.requestFail=function(e){this.invalid(),this.stopMaxTime(),this.failCallBack&&(this.failCallBack(e),this.resetCallback())},e.prototype.stopMaxTime=function(){this.fe.info("".concat(f.zub," stop max timer")),this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},e.prototype.resetCallback=function(){this.sucCallBack=void 0,this.failCallBack=void 0},e}(),m=(s=function(e,r){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])},s(e,r)},function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function t(){this.constructor=e}s(e,r),e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)}),h=function(e){function r(r,t,n){var i=e.call(this,r,t)||this;return i.fe=r,i.de=t,i.ge=n,i.RETRY_MAX_TIME=8,i}return m(r,e),r.prototype.initReqParams=function(e,r){this.streamId=e,this.cdnPushConfig=r},r.prototype.active=function(e){var r=this;if(void 0===e&&(e=!1),this.retryTimer)this.fe.warn("".concat(f.v$W," was actived, ignore"));else if(this.isOverTime)this.fe.warn("".concat(f.v$W," retry over time, stop retry"));else{var t=function(){r.clearRetryTimer(),r.ge.sendCDNRequest(r.streamId,r.cdnPushConfig,(function(e,t){var n=e.body;r.invalid(),r.stopMaxTime(),r.sucCallBack&&(r.sucCallBack&&r.sucCallBack(n,t),r.resetCallback())}),(function(e){r._err=e;var t=e.status_code;r.isOverTime?r.requestFail(e):((429===t||t>=500&&t<600)&&r.setRetryRule(1),r.active())})),e||r.attempt++};if(e)t();else{var n=this.getRetryDelayByCount(this.attempt);this.retryTimer=setTimeout(t,n)}}},r}(l),g=i(3788);const p=i(6994);(g=g.default||g).util.Long=p.default||p,g.util.Long.fromBits=g.util.Long.fromBits||function(){return 0};for(var _=g.roots,v=g.types?g.types.basic:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0,string:2,bytes:2},b=g.types?g.types.packed:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0},k=Object.keys(v),z={$:function(e){return z[e]?z[e].call(this):_[e].decode?_[e].decode(this,this.uint32()):z.$.call(this,"int32")}},y={$:function(e,r,t){var n=v[e];return void 0===n?_[e].encode?(this.uint32(t<<3|2).fork(),_[e].encode(r,this).ldelim()):y.$.call(this,"int32",r,t):y[e].call(this.uint32(t<<3|n),r)}},E=0;E<k.length;E++)z[k[E]]=g.Reader.prototype[k[E]],y[k[E]]=g.Writer.prototype[k[E]];!function e(r,t,n,i){for(var o=0,s=Object.keys(r);o<s.length;o++){var u=s[o];if(r[u].$m&&Object.keys(r[u].$m).every((function(e){return Number(e)}))){if(n[u])throw Error(`nested type ${n}.${u} has already exist`);n[u]=function(r,n){function i(e){for(var t in r){var n=r[t];"{"===n[1].charAt(0)?this[n[0]]={}:"["!==n[1].charAt(0)&&"<"!==n[1].charAt(0)||(this[n[0]]=[])}if(e)for(var i=Object.keys(e),o=0;o<i.length;++o)null!=e[i[o]]&&(this[i[o]]=e[i[o]])}var o={};for(var s in r){var u=r[s],c=u[1];"{"===c.charAt(0)?(i.prototype[u[0]]=g.util.emptyObject,o[c]={$m:c.substring(1).split(",").map((function(e,r){return[`$${r+1}`,e,null]})).reduce((function(e,r,t){return e[t+1]=r,e}),{})}):i.prototype[u[0]]="["===c.charAt(0)||"<"===c.charAt(0)?g.util.emptyArray:"bytes"===c?g.util.newBuffer([]):u[2]&&u[2].hasOwnProperty("low")&&u[2].hasOwnProperty("high")?g.util.Long.fromBits(u[2].low,u[2].high,u[2].unsigned):u[2]}return i.create=function(e){return new i(e)},i.decode=function(e,t){e instanceof g.Reader||(e=g.Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,o=new i;e.pos<n;){var s=e.uint32(),u=s>>>3;if(u>0&&r[u]){var c=r[u][0],a=r[u][1];if("{"===a.charAt(0)){o[c]===g.util.emptyObject&&(o[c]={});var f=i.$namespace[a].decode(e,e.uint32());o[c][f.$1]=f.$2}else if("["===a.charAt(0)||"<"===a.charAt(0)){a=a.substring(1),o[c]&&o[c].length||(o[c]=[]);if(void 0!==b[a=!z[a]&&!_[a].decode?"int32":a]&&2==(7&s))for(var d=e.uint32()+e.pos;e.pos<d;)o[c].push(z.$.call(e,a));else o[c].push(z.$.call(e,a))}else o[c]=z.$.call(e,a)}else e.skipType(7&s)}return o},i.encode=function(e,t){for(var n in t||(t=g.Writer.create()),r){var o=r[n][0],s=r[n][1];if("{"===s.charAt(0)){if(null!=e[o]&&e.hasOwnProperty(o))for(var u=0,c=Object.keys(e[o]);u<c.length;++u)t.uint32(n<<3|2).fork(),i.$namespace[s].encode({$1:c[u],$2:e[o][c[u]]},t).ldelim()}else if("["===s.charAt(0)||"<"===s.charAt(0)){var a="<"===s.charAt(0);s=s.substring(1);var f=e[o];if(null!=f&&f.length){if(s=void 0===v[s]&&!_[s].encode?"int32":s,a&&void 0!==b[s]){t.uint32(n<<3|2).fork();for(u=0;u<f.length;u++)y[s].call(t,f[u]);t.ldelim()}else for(u=0;u<f.length;u++)y.$.call(t,s,f[u],n)}}else null!=e[o]&&e.hasOwnProperty(o)&&y.$.call(t,s,e[o],n)}return t},Object.keys(o).length&&(i.$namespace=e(o,t+"."+n,i.$namespace||{},!0)),i}(r[u].$m,u)}else r[u].$s?n[u]=function(e,r){function n(e,r,t){g.rpc.Service.call(this,e,r,t)}return(n.prototype=Object.create(g.rpc.Service.prototype)).constructor=n,n.create=function(e,r,t){return new n(e,r,t)},Object.keys(e).forEach((function(i){var o=e[i];function s(e,r){return this.rpcCall(s,_[o[0]],_[o[1]],e,r)}Object.defineProperty(s,"name",{value:i}),Object.defineProperty(s,"path",{value:`${t}.${r}`}),n.prototype[i]=s})),n}(r[u].$s,u):r[u].$e&&Object.values(r[u].$e).every((function(e){return Number(e)===e}))&&(n[u]=function(e){for(var r=Object.keys(e),t={},n=0;n<r.length;n++)t[t[r[n]]=e[r[n]]]=r[n];return t}(r[u].$e));n[u]&&!i&&(_[`${t}.${u}`]=n[u]),delete r[u].$m,delete r[u].$s,delete r[u].$e,n[u]=e(r[u],t?`${t}.${u}`:u,n[u]||{})}return n}({media:{proto_media:{MediaServerCommonResponse:{$m:{1:["code","uint32",0],2:["message","string",""]}},RelayPublishCdnRequest:{$m:{1:["request_seq","uint32",0],2:["request_cmd","int32",0],3:["streamid","string",""],4:["cdn_server","string",""],5:["publish_timeout","uint32",0],6:["request_seq_v2","uint64",{low:0,high:0,unsigned:!0}]}},RelayPublishCdnResponse:{$m:{1:["request_seq","uint32",0],2:["response","media.proto_media.MediaServerCommonResponse",null],3:["request_seq_v2","uint64",{low:0,high:0,unsigned:!0}]}}}}},"",_,!1);var w,O=_.media,P=i(7202),q=O.proto_media;w=i(3788);var j=P.A;(w=w.default||w).util.Long=j,w.configure();var x,S=function(){function e(){}return e.prototype.encodeRelayPublishCdnReq=function(e){var r=q.RelayPublishCdnRequest.create(e);return q.RelayPublishCdnRequest.encode(r).finish()},e.prototype.decodeRelayPublishCdnRsp=function(e){var r=q.RelayPublishCdnResponse.decode(e);return r.request_seq_v2&&j.isLong(r.request_seq_v2)&&(r.request_seq_v2=r.request_seq_v2.toNumber()),r},e}();!function(e){e[e.I=0]="I",e[e.H=10]="H",e[e.M=100]="M",e[e.L=1e3]="L"}(x||(x={}));var D={},C={_sendCDNPublishByAccessHub:function(e,r,t,n){var i=this;this.mediaProtoBuf||(this.mediaProtoBuf=new S);var o=new h(this.logger,this.stateCenter,this);o.initReqParams(e,r);var s=function(e,r){try{var t=i.mediaProtoBuf.decodeRelayPublishCdnRsp(e);i.logger.info("zb.sh.pt rsp decode ".concat(JSON.stringify(t)));var n=(null==t?void 0:t.response)||{};return{code:n.code,msg:n.message}}catch(e){return{code:-1}}};o.initCallback((function(e,o){var c=s(e),a=c.code,f=c.msg;a&&0!=a?(i.logger.error("zb.sh.pt "+r.type+" error code: "+a+" "+f),n(5004===a?u.a$$:u.Oy0," cmd: ".concat(r.type," ").concat(a," ").concat(f))):(i.logger.info("zb.sh.pt "+r.type+" success"),t&&t({errorCode:0,extendedData:""}))}),(function(e){var t=e.status_code,o=e.body,u=e.code,f=e.msg,d=JSON.parse(JSON.stringify(c.Of.error.ae)),l="";if(u)d={code:u,msg:f},l=f;else if(200===t)i.logger.info("zb.sh.pt error: "),d=c.Of.error.ae,l="cmd: ".concat(r.type);else{var m="";if((0,a.QP)(o))m=o;else{var h=s(o);m=h.code+" "+h.msg}l="request media server fail, error: "+t+" "+m}i.logger.error("zb.sh.pt "+l),n&&n(d,l)})),o.startMaxTime(),o.active(!0)},sendCDNRequest:function(e,r,t,n){var i=this,o="addpush"===r.type?1:2,s={request_seq:this.stateCenter.cdnSeq++,request_cmd:o,streamid:e,cdn_server:r.pushUrl,request_seq_v2:this.stateCenter.cdnSeqV2++};this.logger.info("zb.sh.scpba "+JSON.stringify(s));var u=this.mediaProtoBuf.encodeRelayPublishCdnReq(s);this.sendHttpPBRequest({interfaceID:6,resID:this.stateCenter.appid+"/"+e},u,(function(e,r){i.logger.info("zb.sh.pt receive message "+(null==e?void 0:e.status_code)),t&&t(e,r)}),(function(e){n&&n(e)}),{timeout:4e3})},_publishTarget:function(e,r,t){this.logger.info("zb.sh.pt call");var n=e.streamID;this.stateCenter.testEnvironment&&(n="zegotest-"+this.stateCenter.appid+"-"+e.streamID),this._sendCDNPublishByAccessHub(n,e,r,t)}},N=function(){function e(e,r,t,n){this.fe=e,this.dataReport=r,this.pe=t,this.de=n,this.screenShotReady=!1}return Object.defineProperty(e.prototype,"_e",{get:function(){return this.de.reporter},enumerable:!1,configurable:!0}),e.prototype.publishTarget=function(e){var r=this,t="";switch(e.type){case"addpush":t=c.iJ.event;break;case"delpush":case"clearpush":t=c.ns.event}var n=this._e.createSpan(x.H,{key:c.pO.event,par:e.streamID},{key:""},t);return n.setAttributes({url:c.ns.url(e.pushUrl)}),new d.l3((function(t,i){var o=function(e,t){r.fe.error("zb.pt "+(t||e.message)),r._e.setError(n,e,t),i({errorCode:e.code,extendedData:e.message+(t?" "+t:"")})};if(-1==["addpush","delpush","clearpush"].indexOf(e.type))return r.fe.error("zb.sh.pt cdn push type error"),void o(u.rBJ,"type error");if(e.streamID&&(0,a.QP)(e.streamID))if(e.pushUrl&&(0,a.QP)(e.pushUrl))if(r.de.publishStreamList[e.streamID]){var s=r.pe.getRoomByStreamID(e.streamID);if(s){s.streamHandler._publishTarget(e,(function(e){n.end(),t(e)}),o)}else o(c.Of.error.oe)}else o(c.Of.error.ie);else o(c.Of.error.ne,"push url error");else o(c.Of.error.ne,"stream id type error")}))},e}(),$={type:"StreamCDN",install:function(e,r,t){for(var n in Object.defineProperty(r.prototype,"initStreamCDN",{value:function(){this.streamCDNModule=new N(this.logger,this.dataReport,this.streamCenter,this.stateCenter)},writable:!1}),D)Object.defineProperty(e.prototype,n,{value:D[n],writable:!1});for(var n in C)Object.defineProperty(t.prototype,n,{value:C[n],writable:!1})}};return o}()}));